containers:
  - name: "init-chown-data"
    imageDetails:
      imagePath: %(a_docker_image_path)s
      username: %(a_docker_image_username)s
      password: %(a_docker_image_password)s
    imagePullPolicy: "IfNotPresent"
    command: ["/bin/sh", "-c", "chown -R 65534:65534 /prometheus && while true; do sleep 86400; done"]
  - name: %(name)s
    imageDetails:
      imagePath: %(docker_image_path)s
      username: %(docker_image_username)s
      password: %(docker_image_password)s
    ports:
    - containerPort: %(advertised-port)s
      protocol: TCP
    config:
      ALLOW_ANONYMOUS_LOGIN: 'yes'
      OSM_SERVER: %(osm-server)s
      OSM_PROM_PORTS: %(advertised-port)s
    command:
      - "sh"
      - "-c"
      - "/bin/prometheus --config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus --web.console.libraries=/usr/share/prometheus/console_libraries --web.console.templates=/usr/share/prometheus/consoles --web.route-prefix=%(web-subpath)s --web.external-url=http://localhost:%(advertised-port)s%(web-subpath)s"
    files:
    - name: config
      mountPath: /etc/prometheus
      files:
        prometheus.yml: |
          global:
            scrape_interval:     15s
            evaluation_interval: 15s
          alerting:
            alertmanagers:
            - static_configs:
              - targets:
          rule_files:
          scrape_configs:
            - job_name: 'prometheus'
              static_configs:
              - targets: ['%(mon_uri)s']
